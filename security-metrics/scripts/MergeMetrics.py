import os
import csv
import tldextract
from datetime import datetime

droppers = []
filecount = 0
csvColumns = ['dateTime','url','domain','tld','ip','country']
sortedFile = "..\\processed_data\\SortedMetrics.csv"

for r, d, f in os.walk(os.getcwd() + "//..//"):
    for file in f:
        print(file)
        if "_ips" not in file:
            continue
        print(file)
        with open(os.path.join(r, file), 'r') as csvFile:
            reader = csv.reader(csvFile)
            firstRow = True
            for dateTime,url,domain,tld,ip,country in reader:
                if firstRow:
                    firstRow = False
                    continue
                droppers.append([dateTime,url,domain,tld,ip,country])
        csvFile.close()
        with open(sortedFile, 'a') as csvFile:
            writer = csv.writer(csvFile, delimiter=',',lineterminator='\n')
            if filecount == 0:
                writer.writerow(csvColumns)
            for row in droppers:
                writer.writerow([row[0],row[1],row[2],row[3],row[4],row[5]])
        csvFile.close()
        droppers = []
        filecount = filecount + 1
        
